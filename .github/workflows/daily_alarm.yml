name: Daily Mission Alarm

on:
  schedule:
    - cron: '53 14 * * *'
  workflow_dispatch: # í…ŒìŠ¤íŠ¸ìš© ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  daily-start:
    runs-on: ubuntu-latest
    steps:
      - name: Send Daily Mission Embed
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          # 1. í•œêµ­ ì‹œê°„ ë‚ ì§œ êµ¬í•˜ê¸° & ìš”ì¼ í•œê¸€ë¡œ ë³€í™˜
          # (ì„œë²„ì— í•œê¸€ íŒ¨ì¹˜ê°€ ì•ˆ ë˜ì–´ ìˆì„ ìˆ˜ ìˆì–´ì„œ ì§ì ‘ ë³€í™˜í•©ë‹ˆë‹¤)
          YEAR=$(TZ=Asia/Seoul date +%Y)
          MONTH=$(TZ=Asia/Seoul date +%m)
          DAY=$(TZ=Asia/Seoul date +%d)
          WEEKDAY_NUM=$(TZ=Asia/Seoul date +%u) # 1(ì›”) ~ 7(ì¼)

          # ìš”ì¼ ìˆ«ì -> í•œê¸€ ë³€í™˜
          case $WEEKDAY_NUM in
            1) WEEK_KR="ì›”" ;;
            2) WEEK_KR="í™”" ;;
            3) WEEK_KR="ìˆ˜" ;;
            4) WEEK_KR="ëª©" ;;
            5) WEEK_KR="ê¸ˆ" ;;
            6) WEEK_KR="í† " ;;
            7) WEEK_KR="ì¼" ;;
          esac

          TODAY_FULL="$YEARë…„ $MONTHì›” $DAYì¼ $WEEK_KRìš”ì¼"
          
          # 2. í”„ë¡œí•„ ì´ë¯¸ì§€ ì£¼ì†Œ
          AVATAR_URL="https://raw.githubusercontent.com/todayis-sunny/Algorithm/main/.github/assets/algo_referee.png"
          
          # 3. íƒ€ì„ìŠ¤íƒ¬í”„ (ë©”ì‹œì§€ ì „ì†¡ ì‹œê°„ìš©)
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)

          # 4. JSON ìƒì„±
          payload=$(jq -n \
            --arg username "ğŸ”¥ 1ì¼ 1ì»¤ë°‹" \
            --arg avatar "$AVATAR_URL" \
            --arg title "ğŸ“£ ì˜¤ëŠ˜ì˜ ë¯¸ì…˜ ì‹œì‘!" \
            --arg desc "ì˜¤ëŠ˜ì˜ ì•Œê³ ë¦¬ì¦˜ ë¯¸ì…˜ì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤." \
            --arg today "$TODAY_FULL" \
            --arg timestamp "$TIMESTAMP" \
            '{
              username: $username,
              avatar_url: $avatar,
              embeds: [{
                title: $title,
                description: $desc,
                color: 15548997, # ğŸ”´ ë¹¨ê°„ìƒ‰ (Red)
                fields: [
                  {
                    name: "ğŸ—“ï¸ ì˜¤ëŠ˜ ë‚ ì§œ",
                    value: ("```\n" + $today + "\n```"),
                    inline: false
                  }
                ],
                footer: { text: "started" },
                timestamp: $timestamp
              }]
            }'
          )

          # 4. ì „ì†¡
          curl -H "Content-Type: application/json" -d "$payload" "$DISCORD_WEBHOOK"
