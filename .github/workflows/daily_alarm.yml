name: Daily Mission Alarm

on:
  schedule:
    - cron: '59 7 * * *'
  workflow_dispatch: # í…ŒìŠ¤íŠ¸ìš© ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  daily-start:
    runs-on: ubuntu-latest
    steps:
      - name: Send Daily Mission Embed
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          # 1. í˜„ì¬ ì‹œê°„ êµ¬í•˜ê¸°
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)
          
          # 2. í”„ë¡œí•„ ì´ë¯¸ì§€ ì£¼ì†Œ
          AVATAR_URL="https://raw.githubusercontent.com/todayis-sunny/Algorithm/main/.github/assets/algo_referee.png"

          # 3. JSON ìƒì„± (ë¹¨ê°„ìƒ‰, ë‚´ìš© ë³€ê²½)
          payload=$(jq -n \
            --arg username "ğŸ”¥ 1ì¼ 1ì»¤ë°‹" \
            --arg avatar "$AVATAR_URL" \
            --arg title "ğŸš¨ ì˜¤ëŠ˜ì˜ ë¯¸ì…˜ ì‹œì‘!" \
            --arg desc "ì˜¤ëŠ˜ì˜ ì•Œê³ ë¦¬ì¦˜ ë¯¸ì…˜ì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤." \
            --arg timestamp "$TIMESTAMP" \
            '{
              username: $username,
              avatar_url: $avatar,
              embeds: [{
                title: $title,
                description: $desc,
                color: 15548997, # ğŸ”´ ë¹¨ê°„ìƒ‰ (Red)
                fields: [
                  {
                    name: "\u200b",
                    value: "\u200b",
                    inline: false
                  },
                  {
                    name: "ğŸ“Š í˜„ì¬ ìƒíƒœ",
                    value: "```diff\n- [ë¯¸ì™„ë£Œ] 0/1 (ì˜¤ëŠ˜ í‘¼ ë¬¸ì œ ì—†ìŒ)\n```",
                    inline: false
                  }
                ],
                footer: { text: "started" },
                timestamp: $timestamp
              }]
            }'
          )

          # 4. ì „ì†¡
          curl -H "Content-Type: application/json" -d "$payload" "$DISCORD_WEBHOOK"
