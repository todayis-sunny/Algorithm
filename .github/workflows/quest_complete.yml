name: Algorithm Quest Checker

on:
  push:
    paths:
      # ì•„ë˜ í™•ì¥ì íŒŒì¼ì´ ìˆ˜ì •/ì¶”ê°€ë˜ì—ˆì„ ë•Œë§Œ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.
      - '**.java'   # Java
      - '**.c'      # C
      - '**.cpp'    # C++
      - '**.cc'     # C++ (ê°€ë” ì´ í™•ì¥ìë„ ì“°ì„)
      - '**.py'     # Python
      - '**.kt'     # Kotlin
      - '**.js'     # JavaScript
      - '**.swift'  # Swift
  workflow_dispatch:

jobs:
  mission-complete:
    runs-on: ubuntu-latest
    steps:
      - name: Send Quest Complete Embed
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMIT_MSG: ${{ github.event.head_commit.message }}
          GIT_ACTOR: ${{ github.actor }}
        run: |
          # 1. í˜„ì¬ ì‹œê°„(UTC)ì„ ë””ìŠ¤ì½”ë“œê°€ ì¢‹ì•„í•˜ëŠ” í˜•ì‹(ISO 8601)ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)
          
          AVATAR_URL="https://raw.githubusercontent.com/todayis-sunny/Algorithm/main/.github/assets/algo_referee.png"

          # 2. JSON ìƒì„± (jq ì‚¬ìš©)
          payload=$(jq -n \
            --arg username "ğŸ”¥ 1ì¼ 1ì»¤ë°‹" \
            --arg avatar "$AVATAR_URL" \
            --arg title "â˜˜ï¸ ì”ë””ì‹¬ê¸° ì™„ë£Œ!" \
            --arg desc "**$GIT_ACTOR**ë‹˜ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì½”ë“œë¥¼ ì œì¶œí–ˆìŠµë‹ˆë‹¤." \
            --arg commit "$COMMIT_MSG" \
            --arg timestamp "$TIMESTAMP" \
            '{
              username: $username,
              avatar_url: $avatar,
              embeds: [{
                title: $title,
                description: $desc,
                color: 5763719,
                fields: [{
                  name: "ğŸ“œ ì»¤ë°‹ ë©”ì‹œì§€",
                  value: ("```\n" + $commit + "\n```"),
                  inline: false
                }],
                footer: { text: "completed" },
                timestamp: $timestamp
              }]
            }'
          )

          # 3. ì „ì†¡
          curl -H "Content-Type: application/json" -d "$payload" "$DISCORD_WEBHOOK"
